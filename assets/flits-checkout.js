window.flitsApp&&void 0!==window.flitsApp||(window.flitsApp={}),window.flitsApp.formatMoney=function(e,t){"string"==typeof e&&(e=e.replace(".",""));var o="",i=/\{\{\s*(\w+)\s*\}\}/,n=t||"${{amount}}";function r(e,t){return void 0===e?t:e}function c(e,t,o,i){if(t=r(t,2),o=r(o,","),i=r(i,"."),isNaN(e)||null==e)return 0;var n=(e=(e/100).toFixed(t)).split(".");return n[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+o)+(n[1]?i+n[1]:"")}switch(n.match(i)[1]){case"amount":o=c(e,2);break;case"amount_no_decimals":o=c(e,0);break;case"amount_with_comma_separator":o=c(e,2,".",",");break;case"amount_no_decimals_with_comma_separator":o=c(e,0,".",",")}return n.replace(i,o)},window.flitsApp.credit_on_shipping_method=function(){var e=this;if(this.customer_id="",this.customer_url="",this.token="",this.moneyFormat="",this.checkbox_format="",this.checkbox_div="",this.select_format="",this.store_credit_applied="",this.cart_data={},this.spent_rules={},this.applied_discount_code_span=".applied-reduction-code__information",document.querySelector(".reduction-code__text")&&(this.applied_discount_code_span=".reduction-code__text"),this.get_ajax_obj=function(){return window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):void 0},this.serialize=function(e){var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")},this.generate_code=function(e){for(var t=this.money_format,o=e.total_credits,i=e.rules,n=0;n<i.length;n++){var r=i[n].applicable_credits,c=i[n].rule.id,a="You can use ##credits## credits out of ##total_credits##.";switch(i[n].rule.rule.column.name){case"cart_value":a=(a=this.spent_rules.credit_cart_percentage.replace("##credits##",window.flitsApp.formatMoney(Math.abs(r),t).replace(/((\,00)|(\.00))$/g,""))).replace("##total_credits##",window.flitsApp.formatMoney(Math.abs(o),t).replace(/((\,00)|(\.00))$/g,""));break;case"checkout_shipping":a=this.spent_rules.free_shipping_rule;break;default:a=(a=a.replace("##credits##",window.flitsApp.formatMoney(Math.abs(r),t).replace(/((\,00)|(\.00))$/g,""))).replace("##total_credits##",window.flitsApp.formatMoney(Math.abs(o),t).replace(/((\,00)|(\.00))$/g,""))}var s=document.createElement("option");s.value=c,s.innerHTML=a,this.select_format.querySelector('select option[value="'+c+'"]')||this.select_format.querySelector("select").appendChild(s)}i.length<=0&&(this.select_format.style.display="none")},this.add_checkbox_code=function(){if(document.querySelector("#flits-use-credit-div"));else for(var t=document.querySelectorAll('form input[name="checkout[reduction_code]"]'),o=0;o<t.length;o++){var i=t[o].closest("form");if(i){var n=e.checkbox_div.cloneNode(!0);i.parentElement.parentNode.insertBefore(n,i.parentElement.nextSibling)}}},this.getCookie=function(e){for(var t=e+"=",o=decodeURIComponent(document.cookie).split(";"),i=0;i<o.length;i++){for(var n=o[i];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""},this.setCookie=function(e,t,o){var i=new Date;i.setTime(i.getTime()+24*o*60*60*1e3);var n="expires="+i.toUTCString();document.cookie=e+"="+t+";"+n+";path=/"},this.isNull=function(e){return void 0===e||null==e||""==e.toString().trim()},this.get_credit=function(e){var t=this,o=t.customer_url+"/get_credit";if(Shopify&&Shopify.Checkout.step==t.step_name){var i=t.get_ajax_obj();i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var o=JSON.parse(this.responseText),i=document.createElement("div");if(i.id="flits-use-credit-div",i.style.marginBottom="1.5em",t.generate_code(o.code),t.checkbox_div=i,t.checkbox_div.append(t.select_format),1==o.is_credit_on_checkout){var n=t.getCookie("flits_discount_code"),r=document.querySelector(t.applied_discount_code_span);if(t.isNull(n)?t.add_checkbox_code():t.isNull(r)?t.add_checkbox_code():n==r.innerHTML||t.add_checkbox_code(),t.isNull(e));else switch(e.step){case"remove_code":var c=setInterval(function(){var e=window.flitsApp.credit_on_shipping_obj,t=document.querySelector(e.applied_discount_code_span),o=e.getCookie("flits_discount_code");e.isNull(t)?(clearInterval(c),e.add_checkbox_code()):o==t.innerHTML||(clearInterval(c),e.add_checkbox_code())},100);break;case"apply_code":c=setInterval(function(){var e=window.flitsApp.credit_on_shipping_obj,t=document.querySelector(e.applied_discount_code_span);e.getCookie("flits_discount_code");e.isNull(t)||(clearInterval(c),e.add_checkbox_code())},100)}}}},i.open("POST",o,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded");var n=t.cart_data;t.isNull(n.token)||(Object.defineProperty(n,"cart_token",Object.getOwnPropertyDescriptor(n,"token")),delete n.token);for(var r=["product_description","title","url","handle","product_type","product_title"],c=0;c<n.items.length;c++)for(var a=0;a<r.length;a++)t.isNull(n.items[c][r[a]])||delete n.items[c][r[a]];var s=t.serialize({token:t.token,cart:btoa(unescape(encodeURIComponent(JSON.stringify(n)))),customer_id:t.customer_id,shipping_price:t.get_shipping_price()});i.send(s)}},this.get_shipping_price=function(){var e=document.querySelector("[data-checkout-total-shipping-target]");return e?e.getAttribute("data-checkout-total-shipping-target"):0},this.getCartData=function(e,t){var o=this.get_ajax_obj();o.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){if("function"==typeof e){var o=JSON.parse(this.responseText);e(o)}}else"function"==typeof t&&t()},o.open("GET","/cart.json",!0),o.send()},this.getFormData=function(t){for(var o=t.querySelectorAll("[name]"),i={},n=0;n<o.length;n++)i[o[n].name]=o[n].value;return e.serialize(i)},this.applyCreditClickEvent=function(){document.addEventListener("click",function(e){var t=e.target,o=t,i=window.flitsApp.credit_on_shipping_obj;if(t.classList.contains("apply-flits-credit")){var n=!1,r=t.closest("#flits-use-credit-div").querySelector("#flits-want-to-use-credit"),c=-1;if((n=!r||"select"!=r.tagName.toString().toLowerCase())&&r.checked)e.preventDefault();else{if(n||"-1"===r.value)return!0;c=r.value,e.preventDefault()}o.setAttribute("disabled",!0),o.classList.add("btn--loading"),i.getCartData(function(e){var t="/credit/apply_credit",n=i.token;t=i.customer_url+t;var r=i.get_ajax_obj();r.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);if(o.setAttribute("disabled",!1),e.status){var t=document.querySelector('input[name="checkout[reduction_code]"]').cloneNode(!0);t.type="hidden",t.value=e.code,document.querySelector('input[name="checkout[reduction_code]"]').closest("form").appendChild(t),document.querySelector('input[name="checkout[reduction_code]"]').closest("form").submit(),o.querySelector(".btn__applied").style.display="inline-block",o.querySelector(".btn__spinner").style.display="none",o.querySelector(".btn__content").style.display="none",i.setCookie("flits_discount_code",e.code,3)}}},r.open("POST",t,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),Object.defineProperty(e,"cart_token",Object.getOwnPropertyDescriptor(e,"token")),delete e.token;for(var a=["product_description","title","url","handle","product_type","product_title"],s=0;s<e.items.length;s++)for(var d=0;d<a.length;d++)i.isNull(e.items[s][a[d]])||delete e.items[s][a[d]];var l="token="+n+"&data="+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+"&spent_rule_id="+c+"&shipping_price="+i.get_shipping_price();r.send(l)},function(){location.href="/checkout"})}}),document.addEventListener("submit",function(e){var t=e.target,o=window.flitsApp.credit_on_shipping_obj;return o.isNull(t.querySelector("#checkout_clear_discount"))||o.get_credit({step:"remove_code"}),o.isNull(t.querySelector("#checkout_reduction_code"))||o.get_credit({step:"apply_code"}),!0})},this.addEventToGoPaymentBtn=function(){if(document.querySelector('[data-trekkie-id="continue_to_payment_method_button"]')){var e=this.getCookie("flits_discount_code"),t=document.querySelector(this.applied_discount_code_span)?document.querySelector(this.applied_discount_code_span).innerHTML:null;if(e&&t&&t==e)if(document.querySelector(".applied-reduction-code__clear-button"))document.querySelector(".applied-reduction-code__clear-button").closest("form").submit()}},this.step_name="payment_method",Shopify&&Shopify.Checkout.step==this.step_name){var t=location.origin+"/?view=flits_customer_data";(c=this.get_ajax_obj()).onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=this.responseText,o=(new DOMParser).parseFromString(t,"text/html"),i=JSON.parse(o.querySelector(".flits-checkout-data").innerHTML),n=o.querySelector(".flits-checkout-checkbox").innerHTML,r=o.querySelector(".flits-checkout-select-credit-div");e.customer_id=i.customer_id,e.customer_url=i.customer_url,e.token=i.token,e.money_format=o.querySelector("#flits-money-format").value,e.checkbox_format=n,e.select_format=r,e.spent_rules=i.spent_rules,e.store_credit_applied=i.store_credit_applied,e.getCartData(function(e){var t=window.flitsApp.credit_on_shipping_obj;t.cart_data=e,t.get_credit(),t.applyCreditClickEvent()},function(){})}},c.open("GET",t,!0),c.send()}if(Shopify&&"shipping_method"==Shopify.Checkout.step&&e.addEventToGoPaymentBtn(),Shopify){var o=e.getCookie("flits_discount_code"),i=document.querySelector(e.applied_discount_code_span)?document.querySelector(e.applied_discount_code_span).innerHTML:null;if(o&&i&&i==o){var n=document.querySelector(".total-line-table "+e.applied_discount_code_span).parentNode,r=document.createElement("span");r.innerHTML="Store Credit Applied",r.className="flits-store-credit-information",n.appendChild(r),document.querySelector(".total-line-table "+e.applied_discount_code_span).style.display="none";var c;t=location.origin+"/?view=flits_customer_data";(c=this.get_ajax_obj()).onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=this.responseText,n=(new DOMParser).parseFromString(t,"text/html"),c=JSON.parse(n.querySelector(".flits-checkout-data").innerHTML);r.innerHTML=c.store_credit_applied;setInterval(function(){if(o&&i&&i==o&&document.querySelector(".total-line-table "+e.applied_discount_code_span)){var t=document.querySelector(".total-line-table "+e.applied_discount_code_span).parentNode;if(!t.querySelector(".flits-store-credit-information")){var n=document.createElement("span");n.innerHTML=c.store_credit_applied,n.className="flits-store-credit-information",t.appendChild(n),document.querySelector(".total-line-table "+e.applied_discount_code_span).style.display="none"}}},100)}},c.open("GET",t,!0),c.send()}}},window.flitsApp.credit_on_shipping_obj=new window.flitsApp.credit_on_shipping_method;